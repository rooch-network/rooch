---
title:  Rooch Network - Bitcoin 的应用层
description: "给 Bitcoin 上的所有资产提供索引，交易以及应用场景的以资产为中心的基础设施"
author: jolestar
date: 2024/04/24
category: Technology
---

## Rooch Network 是什么？

Rooch Network 是 Bitcoin 的应用层，给 Bitcoin 上的所有资产提供索引、交易以及应用场景的以资产为中心的基础设施。

## 为什么需要 Rooch Network？

2023 年 Bitcoin 生态涌现出了各种新型资产协议，这些新型资产的特点是只在 Bitcoin 上登记资产的所有权，合法性在链下验证，可以统称为基于客户端验证（Client side validation）的资产。而这些新资产协议预示的 Bitcoin 生态的远景是什么？业界存在着不同的看法，我们认为 Bitcoin 上的新型资产协议预示着一种新的应用生态构建范式。

客户端验证资产会带来一种新的扩容模式，链上记录资产所有权，链下校验资产的合法性以及给资产提供应用场景。

这种模式特点是资产协议先行，通过公开的协议以及数据结构来表达资产，保证资产标准的通用性。由于合法性在链下校验，所以可以设计出一种跨层资产迁移协议，真正实现资产从链上到链下的迁移。

这种能力，可以让应用运行在链下环境中，但同时可以和链无缝结合起来，让应用不再受限于链的可扩展性难题，带来无限可能。

同时，这种模式也预示着一种可能的应用生态的启动模式。通过应用内资产先吸引用户，构建用户社区，然后社区中诞生应用，解决应用冷启动难题。

那这种模式需要什么样的基础设施来支持呢？

1. 首先，需要一个链下可扩展应用环境。这个环境既可以实现链上资产协议，给协议提供扩展能力，给用户提供资产校验服务。也可以运行应用，给资产提供应用场景。
2. 其次，需要一个资产跨层迁移的协议，以实现资产从链上到链下迁移。
3. 最后，需要一个网络将链下应用互相连接起来，保证应用间的互操作能力，以及资产的跨应用流转。

这是 Rooch Network 要探索和尝试的方向。

## 技术方案和路线图

### 可验证应用容器（VApp Container）

链下的应用环境首先要保证可验证，我们把可验证应用（Verifiable App），简称为 VApp。可验证是去中心化的前提条件，可以逐渐过渡到 DApp。我们用智能合约来保证计算的可验证，用状态树来保证状态的可验证，组合起来于是有了可验证应用容器。

Rooch 团队经过一年时间的开发，完成了 Move 语言的 VApp 容器，它包括以下模块：

![VApp Container](/blog/bitcoin-application-layer/vapp-container.svg)

1. MoveOS：包括 MoveVM 以及分层的状态树，给应用提供执行环境，以及保存应用的状态，保证计算和状态的可验证性。
2. Move 基础库以及框架：包含 Move Stdlib, MoveOS Stdlib, RoochFramework, BitcoinMove 等，给应用提供账户抽象，资产定义，Bitcoin 协议执行等基础功能。 
3. 基础的开发工具，RPC 接口，索引服务，以及 SDK。

基于这个应用容器，应用开发者几乎可以把大多数 Web2 应用通过智能合约实现，变成可验证应用。Rooch 同时引入了 WASM 虚拟机，Move 虚拟机运行应用逻辑，管理状态，WASM 虚拟机提供扩展能力，方便开发者复用已有编程语言的库。

### Root 到 Bitcoin

有了 VApp 容器后，我们需要和 Bitcoin 结合起来。Rooch 采用的方案是直接在 VApp 容器中执行 Bitcoin 网络上的所有区块，解析 UTXO 以及 UTXO 之上附加的扩展协议，转换成智能合约的状态，为 Bitcoin 提供一种链下智能合约的 Layer2 解决方案。

主要提供三种能力：

1. 给 Bitcoin 生态应用提供 Bitcoin 的状态证明。因为 Bitcoin 上的状态，包括 UTXO 以及 Inscription 都会包含在状态树里，我们把状态树的根（Root） 写到 Bitcoin 网络上，就可以给 Bitcoin 生态应用提供 Bitcoin 的状态证明。
2. 给 Bitcoin L1 的资产协议提供扩展能力。基于已有的资产协议扩展新协议，主要的工作是定义和实现新协议的验证规则，而这些可以通过智能合约协议插件的方式来实现。
3. 给 Bitcoin 上所有的数据以及资产提供可编程能力，创造应用场景。

有以下几种模式给 Bitcoin 的数据和资产创建应用场景：

1. 用 Bitcoin L1 资产进行结算。主要有“原子交换”，“PSBT”，“链上支付触发链下结算” 三种模式。这几种模式都需要交易上链，所以需要一种异步编程模型来降低开发者的门槛，这方面 Move 社区已经有 async Move 的扩展尝试，我们可以继续探索这个方向。
2. 通过“原子绑定”模式，绑定 Rooch 的资产到 Bitcoin L1 的资产之上，实现 Rooch 上的资产的所有权随着 Bitcoin L1 资产转移而转移。
3. 通过 Bitcoin L1 的资产来衍生新的资产，相当于基于已有资产发行新资产的一种模式。
4. 在应用中将 Bitcoin L1 的资产作为道具或者身份标志。

更多的模式还需要探索，我们把这种模式叫做“堆叠式”的应用构建模式，应用在链的状态之上堆叠一层状态，来实现对已有的数据和资产的复用。关于“堆叠式”模式的详细方案请参考 [Stackable L2](./stackable-l2)。

### 分布式状态树协议（Distributed State Tree Protocol - DSTP)

VApp 容器都是独立的，如何将它们连接成一个网络？并且实现状态和资产的互通？这是分布式状态树协议需要解决的问题。

分布式状态树协议的思路是通过把分层状态树的不同子树，分散到 P2P 网络的节点上，以实现扩容和并行计算。通过分布式状态树协议，可以让整个网络可以支持无限多的应用，实现并行水平扩容，但同时能通过全局状态来共享数据和资产，以及实现应用的互操作性。

基于“堆叠式”的状态模式，每个 VApp 节点都会包含 Bitcoin 和 Rooch 的状态，它们属于全局状态。而应用的状态是全局状态树的一个子树，可以只存在特定的节点上。如果某个交易只修改了应用的状态，而没有修改全局状态，那个交易就不需要广播到网络中，应用只需定时将自己的状态根同步到全局状态中即可，相当于一种基于应用的分片。

这样就形成了一个 Root 在 Bitcoin 上，数据分散在各种应用到节点上的分布式状态树。应用内的资产可以在状态树之间移动，也可以和 Bitcoin 上的资产互通。

![Distributed State Tree Protocol](/blog/bitcoin-application-layer/dstp.svg)

分布式状态树协议还可以向两个方向扩展：

1. 融合状态通道。状态通道可以理解成一种特殊的有生命周期的状态树。当多方状态通道开启的时候，状态树创建，状态通道结算的时候，应用可以将状态树中的状态丢弃或者结算到上一层。这种场景配合 P2P 网络，非常适合多人即时交互类的应用（游戏）。
2. 支持其他格式的状态树。理论上已有的状态树都可以作为子树挂载到分布式状态树中，比如 git 仓库。这样应用可以直接读取 git 仓库中的文件。

### 跨层的资产迁移协议(CrossLayer Asset Migrate Protocol)

直接在 Bitcoin L1 进行结算，依然存在交易成本高，等待确认时间长的用户体验问题。如何把 Bitcoin 上的资产跨到 L2，这方面当前业界有几种方案：

1. 托管跨链桥的模式。这种模式广泛使用，如何利用 Bitcoin 来保证桥的安全以及去中心化依然是探索的一个方向，Rooch 会和专门的跨链桥项目进行合作，实现资产的桥接，以及通过 Rooch 提供的编程能力增强桥的安全性。
2. 非托管模式：这是 Rooch 主要探索的方向，比如类似 [statechains](https://bitcoinops.org/en/topics/statechains/) 。

而针对 Bitcoin 上的新协议的资产，我们会尝试一种跨层资产迁移协议。链下的智能合约可以给 Bitcoin 提供计算能力上的扩容，而资产迁移协议则要实现状态扩容。
如果未来大量的新型资产发行在 Bitcoin 上，需要一种协议实现资产在 Bitcoin 网络和 L2 之间的迁移，降低 Bitcoin 上的状态存储压力。
同时，L2 上发行的新型资产也要能迁移到 Bitcoin 上，从而获取更高的安全以及更广泛的流通能力。

资产迁移协议的核心思想：Ordinals/RGB 这样的基于客户端验证（Client side validation）的资产，利用 Bitcoin 来登记资产的所有权，但它的合法性在客户端进行验证。如果我们在协议层定义一种指令，表达出将资产从 L1 迁移到 L2，或者从 L2 迁移到 L1，然后客户端可以同时在两层进行验证，我们就可以实现资产的跨层迁移。

为此，Rooch 团队设计了基于 Ordinals 的 SFT 协议 Bitseed，未来会基于 Bitseed 协议来探索资产的迁移协议。

有了 VApp 容器，有了分布式状态树协议，有了资产迁移协议，我们就可以构建一个完整的 Bitcoin 应用层，实现应用的互通，资产的流通，以及应用的扩展，给 Bitcoin 生态的资产带来无限可能。

![Bitcoin Application Layer](/blog/bitcoin-application-layer/bitcoin-application-layer.svg)

### 安全问题

前面的方案描述中并没有涉及安全方案，在 Rooch 网络中，安全主要包含两个方面：

1. 应用端的安全方案，主要是应用状态根的更新权限。
2. 客户端的安全方案，客户端需要有状态校验能力。

应用端的安全需要由应用根据场景以及发展阶段来自定义，主要有几种选项：

1. 基于 Bitcoin 的时间片轮换节点 + 数据可用层 + 欺诈证明：通过时间片轮换来实现多节点切换，保证应用的高可用以及去中心化，欺诈证明用于惩罚作恶的节点。这是 Rooch Network 会采用的方案，我们会尝试和合作伙伴一起探索如何利用 Bitcoin 来作为安全源。
2. PoA 节点 + 数据可用层：该类型的应用可以保证数据的可验证性，任何人都可以运行一个独立的节点对数据进行校验。
3. PoA 节点：该类型的应用可以对外提供状态证明，用户钱包可以校验自己的数据，但由于没有数据可用层保证交易的可用性，存在数据隐藏风险。它可以作为 Web2 应用到 Web3 应用的中间过渡。 
4. 所有参与者多签：适合状态通道类的应用。

客户端验证资产要求钱包不再完全信任节点，而是要求钱包具备一定的校验能力，可以称为智能钱包。

1. 客户端钱包需要有能力接入 P2P 网络，发现网络中的应用的节点，并通过随机抽样机制，校验应用的状态树的根，甚至可以本地运行智能合约虚拟机校验自己的交易。
2. 客户端钱包需要有能力追踪资产的迁移，至少要验证资产迁移的合法性。

这样就形成了基础设施，应用，用户三方的博弈机制，在扩展性和安全性之间寻求一种平衡。应用可以先通过偏中心化的方案，验证市场，然后逐渐过渡，让渡权限，采取一种渐进式的去中心化路线。

## 阶段性路线

Rooch VApp 容器的研发即将发布一个新的稳定版本，我们会基于这个版本启动 Rooch Network 的先行网。

在先行网上，我们会先尝试跨层资产协议的设计，主要包括两个方向：

1. 通过自锁仓衍生资产的模式，发行一种链下的新资产，并尝试从链下迁移到链上。
2. 尝试基于 Bitseed 资产从链上到链下的迁移。包括 NFT 和 FT 两种用 Bitseed 的 SFT 标准发行的资产。

同时，我们会尝试基于 Bitcoin 资产的游戏，也鼓励开发者来构建游戏和应用，构建 VApp 模式的应用生态，通过游戏和应用来给用户分发 Rooch Network 主网代币的期权资产，未来可以用来兑换主网代币。

然后我们会接入 P2P 网络，接入数据可用层，实现节点的去中心化，寻求合作伙伴一起研发基于 Bitcoin 的安全方案，将先行网升级为主网。

## 总结

这篇文章介绍了 Rooch Network 蓝图以及目标，还有尝试验证的途径，它不是一个完备的白皮书。
我们认为很多技术方案都是根据实践演化出来的，而不是规划设计出来的。在 Web3 领域构建项目，相当于大航海时代的海上寻宝。探险者大致知道宝藏的方向和价值，但具体的途径需要寻找和摸索。
我们只能先做一些假设，然后设计最小化的协议和产品，在市场中进行验证，解决难题，调整方向，不断循环，最终我们会寻找到 Web3 的 One Piece。