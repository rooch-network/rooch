# 多链结算

多链结算是 Rooch Network 最重要的功能之一。本章详细介绍了协议和要解决的挑战。

## 它如何工作

import Image from "next/image";

<Image
  src="/docs/multi-chain-settlement.png"
  alt="Rooch Architecture"
  width={600}
  height={600}
  className="mx-auto my-4"
/>

结算层的职责是在 Layer1 和执行层之间进行状态迁移和资产结算。

我们以以太坊为例来说明结算层是如何工作的。

Rooch 在以太坊上部署了结算智能合约（`状态承诺链（State Commitment Chain）`和`桥（Bridge）`），维护着一棵链下状态树，链上只记录状态树的根，用户通过它在 Layer1 和 Rooch 之间迁移状态。

1. 当用户将状态从 Layer1 迁移到 Rooch 时，该状态会在 Layer1 中的交易完成后出现在 Rooch 的状态树中。
2. 当用户从 Rooch 迁移状态到 Layer1 时，状态首先被锁定，等待 Layer2 完成（挑战期结束或 **zkProver** 提供有效证明），然后移出状态树进行结算。
3. 当`状态承诺链`从仲裁合约收到欺诈发生的通知时，它会将链下状态树的根回滚到欺诈发生之前，并丢弃在此期间所做的任何状态树更改。

现在，如果我们要把结算层扩展到多条链上，我们会遇到一些挑战。

如何在其他链上维护`状态承诺链`？

我们的解决方案是通过以太坊状态证明将`状态承诺链`从以太坊镜像到其他链。

那么，另一个挑战是如何在其他链上验证以太坊的状态证明？

我们依赖于将以太坊状态根同步到其他链的解决方案。这是所有跨链解决方案都面临的挑战。这个问题有一些解决方案，比如以太坊轻节点、预言机等，大家可以一起探讨。

## 特性

这就是为什么 Rooch 的多链结算解决方案更先进的原因。

- 多链结算更安全。多链结算方案中跨层桥（cross-layer bridge）的安全性由仲裁层（即以太坊）保护，执行层继承仲裁层的安全性。
- 更通用的跨层解决方案。在 Rooch 的多链结算方案中，跨层是通过一种通用的状态迁移模式实现的，状态可以用来表示 Token、NFT、数字合约等未来的应用状态，而无需为新的状态类型设计专门的协议。
